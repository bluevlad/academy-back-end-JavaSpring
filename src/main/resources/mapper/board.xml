<?xml version="1.0" encoding="UTF-8"?>
<!--
	수정일           	수정자           수정내용
  ===========      =========    =================
 *2025.02.00		rainend		 공지사항 -> 게시판(acm_board) 매퍼로 수정
 *2025.12.10        system       게시판 관리 기능 확장 (MySQL 버전)
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.academy.mapper.BoardMapper">

	<!-- =====================================================
	     게시판 관리 (TB_BOARD_MNG) 관련
	     ===================================================== -->

	<!-- 게시판 관리 목록 조회 -->
	<select id="selectBoardMngList" parameterType="com.academy.board.service.BoardMngVO" resultType="com.academy.board.service.BoardMngVO">
		SELECT
			A.BOARD_MNG_SEQ,
			A.BOARD_MNG_NAME,
			CASE A.ONOFF_DIV
				WHEN 'O' THEN '온라인'
				WHEN 'F' THEN '오프라인'
				WHEN 'T' THEN '강사용'
				ELSE A.ONOFF_DIV
			END AS ONOFF_DIV_NM,
			A.ONOFF_DIV,
			A.BOARD_MNG_TYPE,
			(SELECT CODE_NM FROM TB_BA_CONFIG_CD WHERE SYS_CD = 'BOARD_MNG_TYPE' AND CODE_VAL = A.BOARD_MNG_TYPE) AS BOARD_MNG_TYPE_NM,
			CASE A.OPEN_YN WHEN 'Y' THEN '로그인' WHEN 'N' THEN '비로그인' ELSE A.OPEN_YN END AS OPEN_YN_NM,
			CASE A.IS_USE WHEN 'Y' THEN '활성' WHEN 'N' THEN '비활성' ELSE A.IS_USE END AS IS_USE_NM,
			DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			A.REG_ID,
			DATE_FORMAT(A.UPD_DT, '%Y-%m-%d %H:%i:%s') AS UPD_DT,
			A.UPD_ID,
			(SELECT COUNT(BOARD_SEQ) FROM TB_BOARD WHERE BOARD_MNG_SEQ = A.BOARD_MNG_SEQ) AS CNT,
			(SELECT COUNT(BOARD_SEQ) FROM TB_BOARD WHERE BOARD_MNG_SEQ = A.BOARD_MNG_SEQ AND DATE_FORMAT(REG_DT, '%Y-%m-%d') = CURDATE()) AS TODAY
		FROM TB_BOARD_MNG A
		WHERE 1=1
		<if test="searchOnoffDiv != null and searchOnoffDiv != ''">
			AND A.ONOFF_DIV = #{searchOnoffDiv}
		</if>
		<if test="onoffDiv != null and onoffDiv != ''">
			AND A.ONOFF_DIV = #{onoffDiv}
		</if>
		<if test="searchKeyword != null and searchKeyword != ''">
			<choose>
				<when test='searchType == "BOARD_MNG_SEQ"'>
					AND A.BOARD_MNG_SEQ LIKE CONCAT('%', #{searchKeyword}, '%')
				</when>
				<when test='searchType == "BOARD_MNG_NAME"'>
					AND A.BOARD_MNG_NAME LIKE CONCAT('%', #{searchKeyword}, '%')
				</when>
				<otherwise>
					AND (A.BOARD_MNG_SEQ LIKE CONCAT('%', #{searchKeyword}, '%')
						OR A.BOARD_MNG_NAME LIKE CONCAT('%', #{searchKeyword}, '%'))
				</otherwise>
			</choose>
		</if>
		ORDER BY A.REG_DT DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- 게시판 관리 목록 건수 조회 -->
	<select id="selectBoardMngListCount" parameterType="com.academy.board.service.BoardMngVO" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM TB_BOARD_MNG A
		WHERE 1=1
		<if test="searchOnoffDiv != null and searchOnoffDiv != ''">
			AND A.ONOFF_DIV = #{searchOnoffDiv}
		</if>
		<if test="onoffDiv != null and onoffDiv != ''">
			AND A.ONOFF_DIV = #{onoffDiv}
		</if>
		<if test="searchKeyword != null and searchKeyword != ''">
			<choose>
				<when test='searchType == "BOARD_MNG_SEQ"'>
					AND A.BOARD_MNG_SEQ LIKE CONCAT('%', #{searchKeyword}, '%')
				</when>
				<when test='searchType == "BOARD_MNG_NAME"'>
					AND A.BOARD_MNG_NAME LIKE CONCAT('%', #{searchKeyword}, '%')
				</when>
				<otherwise>
					AND (A.BOARD_MNG_SEQ LIKE CONCAT('%', #{searchKeyword}, '%')
						OR A.BOARD_MNG_NAME LIKE CONCAT('%', #{searchKeyword}, '%'))
				</otherwise>
			</choose>
		</if>
	</select>

	<!-- 게시판 타입 목록 조회 -->
	<select id="selectBoardTypeList" resultType="com.academy.board.service.BoardTypeVO">
		SELECT CODE_CD, CODE_NM FROM TB_BA_CONFIG_CD WHERE SYS_CD = 'BOARD_MNG_TYPE'
	</select>

	<!-- 게시판 관리 상세 조회 -->
	<select id="selectBoardMngDetail" parameterType="com.academy.board.service.BoardMngVO" resultType="com.academy.board.service.BoardMngVO">
		SELECT
			A.BOARD_MNG_SEQ,
			A.BOARD_MNG_NAME,
			A.ONOFF_DIV,
			CASE A.ONOFF_DIV WHEN 'O' THEN '온라인' WHEN 'F' THEN '오프라인' WHEN 'T' THEN '강사용' ELSE A.ONOFF_DIV END AS ONOFF_DIV_NM,
			A.BOARD_MNG_TYPE,
			(SELECT CODE_NM FROM TB_BA_CONFIG_CD WHERE SYS_CD = 'BOARD_MNG_TYPE' AND CODE_CD = A.BOARD_MNG_TYPE) AS BOARD_MNG_TYPE_NM,
			A.ATTACH_FILE_YN,
			A.OPEN_YN,
			A.REPLY_YN,
			A.IS_USE,
			DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			A.REG_ID,
			DATE_FORMAT(A.UPD_DT, '%Y-%m-%d %H:%i:%s') AS UPD_DT,
			A.UPD_ID
		FROM TB_BOARD_MNG A
		WHERE A.BOARD_MNG_SEQ = #{detailBoardMngSeq}
	</select>

	<!-- 게시판 관리 등록 -->
	<insert id="insertBoardMng" parameterType="com.academy.board.service.BoardMngVO">
		<selectKey keyProperty="boardMngSeq" resultType="String" order="BEFORE">
			SELECT CONCAT(#{boardMngType}, '_', LPAD(IFNULL(CAST(SUBSTRING(MAX(BOARD_MNG_SEQ), -3) AS UNSIGNED) + 1, 1), 3, '0'))
			FROM TB_BOARD_MNG
			WHERE BOARD_MNG_TYPE = #{boardMngType}
		</selectKey>
		INSERT INTO TB_BOARD_MNG (
			BOARD_MNG_SEQ,
			BOARD_MNG_NAME,
			ONOFF_DIV,
			BOARD_MNG_TYPE,
			ATTACH_FILE_YN,
			OPEN_YN,
			REPLY_YN,
			IS_USE,
			REG_DT,
			REG_ID,
			UPD_DT,
			UPD_ID
		) VALUES (
			#{boardMngSeq},
			#{boardMngName},
			#{onoffDiv},
			#{boardMngType},
			'Y',
			#{openYn},
			<choose>
				<when test="boardMngType == 'BOARD' or boardMngType == 'TCC'">#{replyYn},</when>
				<otherwise>'N',</otherwise>
			</choose>
			#{isUse},
			now(),
			#{regId},
			now(),
			#{regId}
		)
	</insert>

	<!-- 게시판 관리 수정 -->
	<update id="updateBoardMng" parameterType="com.academy.board.service.BoardMngVO">
		UPDATE TB_BOARD_MNG
		SET
			BOARD_MNG_NAME = #{boardMngName},
			<if test="boardMngType == 'BOARD' or boardMngType == 'TCC'">
			REPLY_YN = #{replyYn},
			</if>
			OPEN_YN = #{openYn},
			IS_USE = #{isUse},
			UPD_DT = now(),
			UPD_ID = #{updId}
		WHERE BOARD_MNG_SEQ = #{detailBoardMngSeq}
	</update>

	<!-- 게시판 관리 삭제 -->
	<delete id="deleteBoardMng" parameterType="com.academy.board.service.BoardMngVO">
		DELETE FROM TB_BOARD_MNG WHERE BOARD_MNG_SEQ = #{detailBoardMngSeq}
	</delete>

	<!-- 게시판 관리 일괄 삭제 -->
	<delete id="deleteBoardMngBatch" parameterType="com.academy.board.service.BoardMngVO">
		DELETE FROM TB_BOARD_MNG WHERE BOARD_MNG_SEQ IN (${deleteIds})
	</delete>

	<!-- 게시판 종류 정보 조회 -->
	<select id="selectBoardKind" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardKindVO">
		SELECT
			BOARD_MNG_SEQ,
			BOARD_MNG_NAME,
			ONOFF_DIV,
			BOARD_MNG_TYPE,
			ATTACH_FILE_YN,
			OPEN_YN,
			REPLY_YN
		FROM TB_BOARD_MNG
		WHERE BOARD_MNG_SEQ = #{boardMngSeq}
	</select>

	<!-- =====================================================
	     게시판 (TB_BOARD) 관련
	     ===================================================== -->

	<!-- 게시판 리스트 -->
	<select id="selectBoardList" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardVO">
		SELECT
		A.BOARD_MNG_SEQ,
		A.BOARD_SEQ,
		A.PARENT_BOARD_SEQ,
		A.SUBJECT,
		A.CONTENT,
		A.FILE_PATH,
		A.FILE_NAME,
		A.REAL_FILE_NAME,
		A.NOTICE_TOP_YN,
		A.OPEN_YN,
		A.HITS,
		DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
		A.REG_ID,
		DATE_FORMAT(A.UPD_DT, '%Y-%m-%d %H:%i:%s') AS UPD_DT,
		A.UPD_ID,
		A.CREATENAME,
		A.THUMBNAIL_FILE_PATH,
		A.THUMBNAIL_FILE_NAME,
		A.THUMBNAIL_FILE_REAL_NAME,
		A.RECOMMEND,
		A.IS_USE,
		A.PROF_ID,
		(SELECT FILE_NAME FROM TB_BOARD_FILE WHERE BOARD_SEQ = A.BOARD_SEQ LIMIT 1) AS ATTACH_FILE_NAME
		FROM TB_BOARD A
		LEFT JOIN TB_BOARD_MNG B ON A.BOARD_MNG_SEQ = B.BOARD_MNG_SEQ
		WHERE 1=1
		<if test="boardMngSeq != null and boardMngSeq != ''">
			AND A.BOARD_MNG_SEQ = #{boardMngSeq}
		</if>
		<if test="searchOnoffDiv != null and searchOnoffDiv != ''">
			AND B.ONOFF_DIV = #{searchOnoffDiv}
		</if>
		<if test="searchCategory != null and searchCategory != ''">
			AND EXISTS (SELECT 1 FROM TB_BOARD_CATEGORY_INFO C WHERE C.BOARD_SEQ = A.BOARD_SEQ AND C.CATEGORY_CODE = #{searchCategory})
		</if>
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test='searchKind == "SEARCHSUBJECT"'>
					AND A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHNAME"'>
					AND A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHCONTENT"'>
					AND A.CONTENT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<otherwise>
					AND (A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
						OR A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
						OR A.CONTENT LIKE CONCAT('%', #{searchText}, '%'))
				</otherwise>
			</choose>
		</if>
		<if test="searchPrfId != null and searchPrfId != ''">
			AND A.PROF_ID = #{searchPrfId}
		</if>
		ORDER BY A.NOTICE_TOP_YN DESC, A.BOARD_SEQ DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- 게시판 게시물 수 -->
	<select id="selectBoardListTotCnt" parameterType="com.academy.board.service.BoardVO" resultType="int">
		SELECT COUNT(*) AS TOTAL_CNT
		FROM TB_BOARD A
		LEFT JOIN TB_BOARD_MNG B ON A.BOARD_MNG_SEQ = B.BOARD_MNG_SEQ
		WHERE 1=1
		<if test="boardMngSeq != null and boardMngSeq != ''">
			AND A.BOARD_MNG_SEQ = #{boardMngSeq}
		</if>
		<if test="searchOnoffDiv != null and searchOnoffDiv != ''">
			AND B.ONOFF_DIV = #{searchOnoffDiv}
		</if>
		<if test="searchCategory != null and searchCategory != ''">
			AND EXISTS (SELECT 1 FROM TB_BOARD_CATEGORY_INFO C WHERE C.BOARD_SEQ = A.BOARD_SEQ AND C.CATEGORY_CODE = #{searchCategory})
		</if>
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test='searchKind == "SEARCHSUBJECT"'>
					AND A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHNAME"'>
					AND A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHCONTENT"'>
					AND A.CONTENT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<otherwise>
					AND (A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
						OR A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
						OR A.CONTENT LIKE CONCAT('%', #{searchText}, '%'))
				</otherwise>
			</choose>
		</if>
		<if test="searchPrfId != null and searchPrfId != ''">
			AND A.PROF_ID = #{searchPrfId}
		</if>
	</select>

	<!-- FAQ 게시판 목록 조회 -->
	<select id="selectBoardFAQList" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardVO">
		SELECT
			A.BOARD_MNG_SEQ,
			A.BOARD_SEQ,
			A.SUBJECT,
			A.ANSWER,
			A.NOTICE_TOP_YN,
			A.OPEN_YN,
			A.IS_USE,
			A.HITS,
			DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			A.REG_ID,
			A.CREATENAME,
			A.PROF_ID
		FROM TB_BOARD A
		LEFT JOIN TB_BOARD_MNG B ON A.BOARD_MNG_SEQ = B.BOARD_MNG_SEQ
		WHERE 1=1
		<if test="boardMngSeq != null and boardMngSeq != ''">
			AND A.BOARD_MNG_SEQ = #{boardMngSeq}
		</if>
		<if test="searchOnoffDiv != null and searchOnoffDiv != ''">
			AND B.ONOFF_DIV = #{searchOnoffDiv}
		</if>
		<if test="searchCategory != null and searchCategory != ''">
			AND EXISTS (SELECT 1 FROM TB_BOARD_CATEGORY_INFO C WHERE C.BOARD_SEQ = A.BOARD_SEQ AND C.CATEGORY_CODE = #{searchCategory})
		</if>
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test='searchKind == "SEARCHSUBJECT"'>
					AND A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHNAME"'>
					AND A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<otherwise>
					AND (A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
						OR A.CREATENAME LIKE CONCAT('%', #{searchText}, '%'))
				</otherwise>
			</choose>
		</if>
		ORDER BY A.NOTICE_TOP_YN DESC, A.BOARD_SEQ DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- FAQ 게시판 목록 건수 조회 -->
	<select id="selectBoardFAQListCount" parameterType="com.academy.board.service.BoardVO" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM TB_BOARD A
		LEFT JOIN TB_BOARD_MNG B ON A.BOARD_MNG_SEQ = B.BOARD_MNG_SEQ
		WHERE 1=1
		<if test="boardMngSeq != null and boardMngSeq != ''">
			AND A.BOARD_MNG_SEQ = #{boardMngSeq}
		</if>
		<if test="searchOnoffDiv != null and searchOnoffDiv != ''">
			AND B.ONOFF_DIV = #{searchOnoffDiv}
		</if>
		<if test="searchCategory != null and searchCategory != ''">
			AND EXISTS (SELECT 1 FROM TB_BOARD_CATEGORY_INFO C WHERE C.BOARD_SEQ = A.BOARD_SEQ AND C.CATEGORY_CODE = #{searchCategory})
		</if>
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test='searchKind == "SEARCHSUBJECT"'>
					AND A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHNAME"'>
					AND A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<otherwise>
					AND (A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
						OR A.CREATENAME LIKE CONCAT('%', #{searchText}, '%'))
				</otherwise>
			</choose>
		</if>
	</select>

	<!-- 강사용 게시판 목록 조회 -->
	<select id="selectBoardTeacherList" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardVO">
		SELECT
			(SELECT NAME FROM TB_CATEGORY_INFO WHERE CODE = #{searchCategory}) AS CODENAME,
			CAST(A.BOARD_SEQ AS UNSIGNED) AS BOARD_SEQ,
			A.SUBJECT,
			A.CONTENT,
			(SELECT FILE_NAME FROM TB_BOARD_FILE WHERE BOARD_SEQ = A.BOARD_SEQ LIMIT 1) AS FILE_NAME,
			A.THUMBNAIL_FILE_NAME,
			A.PARENT_BOARD_SEQ,
			A.NOTICE_TOP_YN,
			A.HITS,
			DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			(SELECT USER_NM FROM TB_MA_MEMBER WHERE USER_ID = A.REG_ID) AS USER_NM,
			DATE_FORMAT(A.UPD_DT, '%Y-%m-%d %H:%i:%s') AS UPD_DT,
			A.UPD_ID,
			A.CREATENAME,
			A.RECOMMEND,
			A.ISSUE,
			A.OPEN_YN,
			A.PROF_ID,
			(SELECT USER_NM FROM TB_MA_MEMBER WHERE USER_ID = A.PROF_ID) AS PROF_NM
		FROM TB_BOARD A
		INNER JOIN TB_BOARD_MNG B ON A.BOARD_MNG_SEQ = B.BOARD_MNG_SEQ
		WHERE A.BOARD_MNG_SEQ = #{boardMngSeq}
		AND B.BOARD_MNG_SEQ = #{boardMngSeq}
		<choose>
			<when test="searchOnoffDiv != null and searchOnoffDiv != ''">
				AND B.ONOFF_DIV = #{searchOnoffDiv}
			</when>
			<otherwise>
				<if test="onoffDiv != null and onoffDiv == 'T'">
					AND B.ONOFF_DIV = 'T'
				</if>
			</otherwise>
		</choose>
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test='searchKind == "SEARCHSUBJECT"'>
					AND A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHNAME"'>
					AND A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHCONTENT"'>
					AND A.CONTENT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<otherwise>
					AND (A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
						OR A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
						OR A.CONTENT LIKE CONCAT('%', #{searchText}, '%'))
				</otherwise>
			</choose>
		</if>
		<if test="searchPrfId != null and searchPrfId != ''">
			AND A.PROF_ID = #{searchPrfId}
		</if>
		ORDER BY A.NOTICE_TOP_YN DESC, A.BOARD_SEQ DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- 강사용 게시판 목록 건수 조회 -->
	<select id="selectBoardTeacherListCount" parameterType="com.academy.board.service.BoardVO" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM TB_BOARD A
		INNER JOIN TB_BOARD_MNG B ON A.BOARD_MNG_SEQ = B.BOARD_MNG_SEQ
		WHERE A.BOARD_MNG_SEQ = #{boardMngSeq}
		AND B.BOARD_MNG_SEQ = #{boardMngSeq}
		<choose>
			<when test="searchOnoffDiv != null and searchOnoffDiv != ''">
				AND B.ONOFF_DIV = #{searchOnoffDiv}
			</when>
			<otherwise>
				<if test="onoffDiv != null and onoffDiv == 'T'">
					AND B.ONOFF_DIV = 'T'
				</if>
			</otherwise>
		</choose>
		<if test="searchText != null and searchText != ''">
			<choose>
				<when test='searchKind == "SEARCHSUBJECT"'>
					AND A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHNAME"'>
					AND A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<when test='searchKind == "SEARCHCONTENT"'>
					AND A.CONTENT LIKE CONCAT('%', #{searchText}, '%')
				</when>
				<otherwise>
					AND (A.SUBJECT LIKE CONCAT('%', #{searchText}, '%')
						OR A.CREATENAME LIKE CONCAT('%', #{searchText}, '%')
						OR A.CONTENT LIKE CONCAT('%', #{searchText}, '%'))
				</otherwise>
			</choose>
		</if>
		<if test="searchPrfId != null and searchPrfId != ''">
			AND A.PROF_ID = #{searchPrfId}
		</if>
	</select>

	<!-- 게시판 상세 조회 -->
	<select id="getBoardDetail" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardVO">
		SELECT
			A.BOARD_MNG_SEQ,
			A.BOARD_SEQ,
			A.PARENT_BOARD_SEQ,
			A.SUBJECT,
			A.CONTENT,
			A.ANSWER,
			A.FILE_PATH,
			A.FILE_NAME,
			A.REAL_FILE_NAME,
			A.NOTICE_TOP_YN,
			A.OPEN_YN,
			A.IS_USE,
			A.HITS,
			DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			A.REG_ID,
			A.UPD_DT,
			A.UPD_ID,
			A.CREATENAME,
			A.BOARD_REPLY,
			A.THUMBNAIL_FILE_PATH,
			A.THUMBNAIL_FILE_NAME,
			A.THUMBNAIL_FILE_REAL_NAME,
			A.RECOMMEND,
			A.ISSUE,
			A.MAIN_YN,
			A.PROF_ID,
			CASE
				WHEN EXISTS (SELECT 1 FROM TB_BOARD X WHERE X.BOARD_MNG_SEQ = A.BOARD_MNG_SEQ AND X.PARENT_BOARD_SEQ = A.BOARD_SEQ) THEN '답변완료'
				WHEN A.PARENT_BOARD_SEQ > 0 THEN '답변완료'
				ELSE CASE A.BOARD_REPLY
					WHEN 'C' THEN '처리중(CS)'
					WHEN 'A' THEN '처리중(운영)'
					WHEN 'Y' THEN '답변완료'
					ELSE '답변대기'
				END
			END AS BOARD_REPLY_NM
		FROM TB_BOARD A
		WHERE A.BOARD_SEQ = #{boardSeq}
	</select>

	<!-- 원본글 상세 조회 -->
	<select id="getBoardDetailOrigin" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardVO">
		SELECT
			A.BOARD_MNG_SEQ,
			A.BOARD_SEQ,
			A.SUBJECT,
			A.CONTENT,
			DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			A.REG_ID,
			A.CREATENAME
		FROM TB_BOARD A
		WHERE A.BOARD_SEQ = #{parentBoardSeq}
	</select>

	<!-- 게시판 등록 -->
	<insert id="insertBoard" parameterType="com.academy.board.service.BoardVO">
		<selectKey keyProperty="boardSeq" resultType="String" order="BEFORE">
			SELECT IFNULL(MAX(CAST(BOARD_SEQ AS UNSIGNED)), 0) + 1 FROM TB_BOARD
		</selectKey>
		INSERT INTO TB_BOARD (
			BOARD_MNG_SEQ,
			BOARD_SEQ,
			PARENT_BOARD_SEQ,
			OPEN_YN,
			SUBJECT,
			CONTENT,
			<if test="filePath != null and filePath != ''">FILE_PATH,</if>
			<if test="fileName != null and fileName != ''">FILE_NAME,</if>
			<if test="realFileName != null and realFileName != ''">REAL_FILE_NAME,</if>
			NOTICE_TOP_YN,
			IS_USE,
			HITS,
			CREATENAME,
			<if test="thumbnailFilePath != null and thumbnailFilePath != ''">THUMBNAIL_FILE_PATH,</if>
			<if test="thumbnailFileName != null and thumbnailFileName != ''">THUMBNAIL_FILE_NAME,</if>
			<if test="thumbnailFileRealName != null and thumbnailFileRealName != ''">THUMBNAIL_FILE_REAL_NAME,</if>
			<if test="recommend != null and recommend != ''">RECOMMEND,</if>
			<if test="issue != null and issue != ''">ISSUE,</if>
			<if test="profId != null and profId != ''">PROF_ID,</if>
			<if test="mockcode != null and mockcode != ''">MOCKCODE,</if>
			<if test="boardReply != null and boardReply != ''">BOARD_REPLY,</if>
			REG_DT,
			REG_ID,
			UPD_DT,
			UPD_ID
		) VALUES (
			#{boardMngSeq},
			#{boardSeq},
			IFNULL(#{parentBoardSeq}, '0'),
			#{openYn},
			#{subject},
			#{boardMemo},
			<if test="filePath != null and filePath != ''">#{filePath},</if>
			<if test="fileName != null and fileName != ''">#{fileName},</if>
			<if test="realFileName != null and realFileName != ''">#{realFileName},</if>
			IFNULL(#{noticeTopYn}, 'N'),
			IFNULL(#{isUse}, 'Y'),
			0,
			#{createName},
			<if test="thumbnailFilePath != null and thumbnailFilePath != ''">#{thumbnailFilePath},</if>
			<if test="thumbnailFileName != null and thumbnailFileName != ''">#{thumbnailFileName},</if>
			<if test="thumbnailFileRealName != null and thumbnailFileRealName != ''">#{thumbnailFileRealName},</if>
			<if test="recommend != null and recommend != ''">#{recommend},</if>
			<if test="issue != null and issue != ''">#{issue},</if>
			<if test="profId != null and profId != ''">#{profId},</if>
			<if test="mockcode != null and mockcode != ''">#{mockcode},</if>
			<if test="boardReply != null and boardReply != ''">#{boardReply},</if>
			now(),
			#{regId},
			now(),
			#{regId}
		)
	</insert>

	<!-- FAQ 게시판 등록 -->
	<insert id="insertBoardFAQ" parameterType="com.academy.board.service.BoardVO">
		<selectKey keyProperty="boardSeq" resultType="String" order="BEFORE">
			SELECT IFNULL(MAX(CAST(BOARD_SEQ AS UNSIGNED)), 0) + 1 FROM TB_BOARD
		</selectKey>
		INSERT INTO TB_BOARD (
			BOARD_MNG_SEQ,
			BOARD_SEQ,
			PARENT_BOARD_SEQ,
			OPEN_YN,
			SUBJECT,
			ANSWER,
			<if test="filePath != null and filePath != ''">FILE_PATH,</if>
			<if test="fileName != null and fileName != ''">FILE_NAME,</if>
			<if test="realFileName != null and realFileName != ''">REAL_FILE_NAME,</if>
			NOTICE_TOP_YN,
			IS_USE,
			HITS,
			CREATENAME,
			<if test="profId != null and profId != ''">PROF_ID,</if>
			REG_DT,
			REG_ID,
			UPD_DT,
			UPD_ID
		) VALUES (
			#{boardMngSeq},
			#{boardSeq},
			'0',
			#{openYn},
			#{subject},
			#{answer},
			<if test="filePath != null and filePath != ''">#{filePath},</if>
			<if test="fileName != null and fileName != ''">#{fileName},</if>
			<if test="realFileName != null and realFileName != ''">#{realFileName},</if>
			IFNULL(#{noticeTopYn}, 'N'),
			IFNULL(#{isUse}, 'Y'),
			0,
			#{createName},
			<if test="profId != null and profId != ''">#{profId},</if>
			now(),
			#{regId},
			now(),
			#{regId}
		)
	</insert>

	<!-- 답변 게시판 등록 -->
	<insert id="insertBoardReply" parameterType="com.academy.board.service.BoardVO">
		<selectKey keyProperty="boardSeq" resultType="String" order="BEFORE">
			SELECT IFNULL(MAX(CAST(BOARD_SEQ AS UNSIGNED)), 0) + 1 FROM TB_BOARD
		</selectKey>
		INSERT INTO TB_BOARD (
			BOARD_MNG_SEQ,
			BOARD_SEQ,
			PARENT_BOARD_SEQ,
			OPEN_YN,
			SUBJECT,
			CONTENT,
			NOTICE_TOP_YN,
			IS_USE,
			HITS,
			BOARD_TYPE,
			CREATENAME,
			<if test="profId != null and profId != ''">PROF_ID,</if>
			<if test="mockcode != null and mockcode != ''">MOCKCODE,</if>
			REG_DT,
			REG_ID,
			UPD_DT,
			UPD_ID
		) VALUES (
			#{boardMngSeq},
			#{boardSeq},
			#{parentBoardSeq},
			#{openYn},
			#{subject},
			#{boardMemo},
			IFNULL(#{noticeTopYn}, 'N'),
			IFNULL(#{isUse}, 'Y'),
			0,
			#{boardType},
			#{createName},
			<if test="profId != null and profId != ''">#{profId},</if>
			<if test="mockcode != null and mockcode != ''">#{mockcode},</if>
			now(),
			#{regId},
			now(),
			#{regId}
		)
	</insert>

	<!-- 게시판 수정 -->
	<update id="updateBoard" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD
		SET
			NOTICE_TOP_YN = #{noticeTopYn},
			OPEN_YN = #{openYn},
			SUBJECT = #{subject},
			CONTENT = #{boardMemo},
			<if test="filePath != null and filePath != ''">FILE_PATH = #{filePath},</if>
			<if test="fileName != null and fileName != ''">FILE_NAME = #{fileName},</if>
			<if test="realFileName != null and realFileName != ''">REAL_FILE_NAME = #{realFileName},</if>
			<if test="thumbnailFilePath != null and thumbnailFilePath != ''">THUMBNAIL_FILE_PATH = #{thumbnailFilePath},</if>
			<if test="thumbnailFileName != null and thumbnailFileName != ''">THUMBNAIL_FILE_NAME = #{thumbnailFileName},</if>
			<if test="thumbnailFileRealName != null and thumbnailFileRealName != ''">THUMBNAIL_FILE_REAL_NAME = #{thumbnailFileRealName},</if>
			<if test="recommend != null">RECOMMEND = #{recommend},</if>
			<if test="issue != null">ISSUE = #{issue},</if>
			<if test="profId != null">PROF_ID = #{profId},</if>
			<if test="mockcode != null">MOCKCODE = #{mockcode},</if>
			UPD_DT = now(),
			UPD_ID = #{updId}
		WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- FAQ 게시판 수정 -->
	<update id="updateBoardFAQ" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD
		SET
			NOTICE_TOP_YN = #{noticeTopYn},
			OPEN_YN = #{openYn},
			SUBJECT = #{subject},
			ANSWER = #{answer},
			<if test="filePath != null and filePath != ''">FILE_PATH = #{filePath},</if>
			<if test="fileName != null and fileName != ''">FILE_NAME = #{fileName},</if>
			<if test="realFileName != null and realFileName != ''">REAL_FILE_NAME = #{realFileName},</if>
			UPD_DT = now(),
			UPD_ID = #{updId}
		WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- 게시판 삭제 -->
	<delete id="deleteBoard" parameterType="com.academy.board.service.BoardVO">
		DELETE FROM TB_BOARD
		WHERE BOARD_MNG_SEQ = #{boardMngSeq}
		AND BOARD_SEQ = #{boardSeq}
	</delete>

	<!-- 조회수 증가 -->
	<update id="updateBoardHits" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD SET HITS = HITS + 1 WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- 이슈 여부 수정 -->
	<update id="updateBoardIssue" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD SET ISSUE = #{issue}, UPD_DT = now(), UPD_ID = #{updId} WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- 추천 여부 수정 -->
	<update id="updateBoardRecommend" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD SET RECOMMEND = #{recommend}, UPD_DT = now(), UPD_ID = #{updId} WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- 공개 여부 수정 -->
	<update id="updateBoardOpenYn" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD SET OPEN_YN = #{openYn}, UPD_DT = now(), UPD_ID = #{updId} WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- 메인 노출 여부 수정 -->
	<update id="updateBoardMainYn" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD SET MAIN_YN = #{mainYn}, UPD_DT = now(), UPD_ID = #{updId} WHERE BOARD_SEQ = #{boardSeq}
	</update>

	<!-- 답변 상태 수정 -->
	<update id="updateBoardReply" parameterType="com.academy.board.service.BoardVO">
		UPDATE TB_BOARD SET BOARD_REPLY = #{boardReply}, UPD_DT = now(), UPD_ID = #{updId}
		WHERE BOARD_SEQ = #{boardSeq} AND BOARD_MNG_SEQ = #{boardMngSeq}
	</update>

	<!-- 답변 존재 여부 확인 -->
	<select id="selectReplyCount" parameterType="com.academy.board.service.BoardVO" resultType="int">
		SELECT COUNT(*) AS CNT FROM TB_BOARD WHERE PARENT_BOARD_SEQ = #{boardSeq}
	</select>

	<!-- 답변 데이터 조회 -->
	<select id="selectReplyData" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.ReplyDataVO">
		SELECT BOARD_SEQ, FILE_PATH
		FROM TB_BOARD
		WHERE BOARD_MNG_SEQ = #{boardMngSeq}
		AND PARENT_BOARD_SEQ = #{boardSeq}
	</select>

	<!-- =====================================================
	     게시판 카테고리 (TB_BOARD_CATEGORY_INFO) 관련
	     ===================================================== -->

	<!-- 직급 코드 목록 조회 -->
	<select id="selectRankCodeList" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.CategoryInfoVO">
		SELECT
			ID, CODE, NAME, IS_USE,
			CASE IS_USE WHEN 'Y' THEN '활성' WHEN 'N' THEN '비활성' ELSE IS_USE END AS IS_USE_NM,
			REG_DT, REG_ID, UPD_DT, UPD_ID
		FROM TB_CATEGORY_INFO
		WHERE IS_USE = 'Y'
		AND P_CODE = 'CLASSCODE'
		<if test="onoffDiv != null and onoffDiv == 'O'">
			AND USE_ON = 'Y'
		</if>
		<if test="onoffDiv != null and onoffDiv == 'F'">
			AND USE_OFF = 'Y'
		</if>
		ORDER BY CODE ASC
	</select>

	<!-- 게시판 카테고리 정보 등록 -->
	<insert id="insertBoardCatInfo" parameterType="com.academy.board.service.BoardVO">
		INSERT INTO TB_BOARD_CATEGORY_INFO (
			BOARD_MNG_SEQ,
			BOARD_SEQ,
			CATEGORY_CODE
		) VALUES (
			#{boardMngSeq},
			#{boardSeq},
			#{categoryCode}
		)
	</insert>

	<!-- 게시판 카테고리 정보 조회 -->
	<select id="selectBoardCodeList" parameterType="com.academy.board.service.BoardVO" resultType="com.academy.board.service.BoardCodeVO">
		SELECT CATEGORY_CODE FROM TB_BOARD_CATEGORY_INFO
		WHERE BOARD_MNG_SEQ = #{boardMngSeq} AND BOARD_SEQ = #{boardSeq}
	</select>

	<!-- 게시판 카테고리 정보 삭제 -->
	<delete id="deleteBoardCatInfo" parameterType="com.academy.board.service.BoardVO">
		DELETE FROM TB_BOARD_CATEGORY_INFO
		WHERE BOARD_SEQ = #{boardSeq} AND BOARD_MNG_SEQ = #{boardMngSeq}
	</delete>

	<!-- =====================================================
	     게시판 첨부파일 (TB_BOARD_FILE) 관련
	     ===================================================== -->

	<!-- 게시판 첨부파일 목록 조회 -->
	<select id="selectBoardFileList" parameterType="com.academy.board.service.BoardFileVO" resultType="com.academy.board.service.BoardFileVO">
		SELECT BOARD_SEQ, FILE_NO, FILE_NAME, FILE_PATH
		FROM TB_BOARD_FILE
		WHERE BOARD_SEQ = #{boardSeq}
	</select>

	<!-- 게시판 이미지 첨부파일 목록 조회 -->
	<select id="selectBoardFileImgList" parameterType="com.academy.board.service.BoardFileVO" resultType="com.academy.board.service.BoardFileVO">
		SELECT BOARD_SEQ, FILE_NO, FILE_NAME, FILE_PATH
		FROM TB_BOARD_FILE
		WHERE BOARD_SEQ = #{boardSeq}
		AND (
			LOWER(RIGHT(FILE_NAME, 3)) IN ('jpg', 'png', 'gif', 'bmp')
			OR LOWER(RIGHT(FILE_NAME, 4)) IN ('jpeg')
		)
	</select>

	<!-- 게시판 첨부파일 등록 -->
	<insert id="insertBoardFile" parameterType="com.academy.board.service.BoardFileVO">
		INSERT INTO TB_BOARD_FILE (
			BOARD_MNG_SEQ,
			BOARD_SEQ,
			FILE_NO,
			FILE_NAME,
			FILE_PATH,
			REG_ID,
			REG_DT,
			UPD_ID,
			UPD_DT
		) VALUES (
			#{boardMngSeq},
			#{boardSeq},
			(SELECT IFNULL(MAX(FILE_NO), 0) + 1 FROM TB_BOARD_FILE A WHERE A.BOARD_SEQ = #{boardSeq}),
			#{fileName},
			#{filePath},
			#{regId},
			now(),
			#{regId},
			now()
		)
	</insert>

	<!-- 답변 게시판 첨부파일 등록 -->
	<insert id="insertBoardReplyFile" parameterType="com.academy.board.service.BoardFileVO">
		INSERT INTO TB_BOARD_FILE (
			BOARD_MNG_SEQ,
			BOARD_SEQ,
			FILE_NO,
			FILE_NAME,
			FILE_PATH,
			REG_ID,
			REG_DT,
			UPD_ID,
			UPD_DT,
			PARENT_BOARD_SEQ
		) VALUES (
			#{boardMngSeq},
			#{boardSeq},
			(SELECT IFNULL(MAX(FILE_NO), 0) + 1 FROM TB_BOARD_FILE A WHERE A.BOARD_SEQ = #{boardSeq}),
			#{fileName},
			#{filePath},
			#{regId},
			now(),
			#{regId},
			now(),
			#{parentBoardSeq}
		)
	</insert>

	<!-- 게시판 첨부파일 삭제 (경로 기준) -->
	<delete id="deleteBoardFileByPath" parameterType="com.academy.board.service.BoardFileVO">
		DELETE FROM TB_BOARD_FILE WHERE FILE_PATH = #{filePath} AND BOARD_SEQ = #{boardSeq}
	</delete>

	<!-- 게시판 첨부파일 삭제 (게시글 기준) -->
	<delete id="deleteBoardFileByBoard" parameterType="com.academy.board.service.BoardFileVO">
		DELETE FROM TB_BOARD_FILE WHERE BOARD_MNG_SEQ = #{boardMngSeq} AND BOARD_SEQ = #{boardSeq}
	</delete>

	<!-- =====================================================
	     게시판 코멘트 (TB_BOARD_COMMENT) 관련
	     ===================================================== -->

	<!-- 게시판 코멘트 목록 조회 -->
	<select id="selectBoardCommentList" parameterType="com.academy.board.service.BoardCommentVO" resultType="com.academy.board.service.BoardCommentVO">
		SELECT
			SEQ,
			CMMT_BOARD_MNG_SEQ,
			CMMT_BOARD_SEQ,
			TITLE,
			CONTENT,
			DATE_FORMAT(REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
			REG_ID,
			(SELECT USER_NM FROM TB_MA_MEMBER WHERE USER_ID = A.REG_ID) AS REG_NM
		FROM TB_BOARD_COMMENT A
		WHERE CMMT_BOARD_MNG_SEQ = #{cmmtBoardMngSeq}
		AND CMMT_BOARD_SEQ = #{cmmtBoardSeq}
		ORDER BY REG_DT DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- 게시판 코멘트 목록 건수 조회 -->
	<select id="selectBoardCommentListCount" parameterType="com.academy.board.service.BoardCommentVO" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM TB_BOARD_COMMENT
		WHERE CMMT_BOARD_MNG_SEQ = #{cmmtBoardMngSeq}
		AND CMMT_BOARD_SEQ = #{cmmtBoardSeq}
	</select>

	<!-- 게시판 코멘트 등록 -->
	<insert id="insertBoardComment" parameterType="com.academy.board.service.BoardCommentVO">
		INSERT INTO TB_BOARD_COMMENT (
			SEQ,
			CMMT_BOARD_MNG_SEQ,
			CMMT_BOARD_SEQ,
			TITLE,
			CONTENT,
			REG_DT,
			REG_ID,
			UPD_DT,
			UPD_ID
		) VALUES (
			REPLACE(UUID(), '-', ''),
			#{cmmtBoardMngSeq},
			#{cmmtBoardSeq},
			#{title},
			#{content},
			now(),
			#{regId},
			now(),
			#{regId}
		)
	</insert>

	<!-- 게시판 코멘트 삭제 -->
	<delete id="deleteBoardComment" parameterType="com.academy.board.service.BoardCommentVO">
		DELETE FROM TB_BOARD_COMMENT WHERE SEQ = #{deleteSeq}
	</delete>

</mapper>
