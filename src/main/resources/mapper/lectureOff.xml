<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.academy.mapper.LectureOffMapper">

    <!-- ============================================= -->
    <!-- 단과 강의 관리 -->
    <!-- ============================================= -->

    <!-- 단과 강의 목록 조회 -->
    <select id="selectLectureList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.SEQ AS seq,
               A.LECCODE AS leccode,
               A.CATEGORY_CD AS categoryCd,
               A.LEARNING_CD AS learningCd,
               A.SUBJECT_TITLE AS subjectTitle,
               A.TEACHER_KEY AS teacherKey,
               A.LEL_DATE AS lelDate,
               A.LEC_GUBUN AS lecGubun,
               A.KIND AS kind,
               A.FORM AS form,
               A.LEC_NUM AS lecNum,
               A.PRICE AS price,
               A.SALE_PRICE AS salePrice,
               A.POINT_USER AS pointUser,
               A.LIMIT_DAY AS limitDay,
               A.MOBILE AS mobile,
               A.ORG_PRICE AS orgPrice,
               A.ISUSE AS isuse,
               DATE_FORMAT(A.INDATE, '%Y-%m-%d %H:%i:%s') AS indateStr,
               (SELECT CATEGORY_NM FROM TB_CATEGORY WHERE CATEGORY_CD = A.CATEGORY_CD LIMIT 1) AS categoryNm,
               (SELECT LEARNING_NM FROM TB_LEARNING WHERE LEARNING_CD = A.LEARNING_CD LIMIT 1) AS learningNm,
               (SELECT TEACHER_NM FROM TB_TEACHER WHERE TEACHER_KEY = A.TEACHER_KEY LIMIT 1) AS teacherNm
          FROM TB_OFF_LEC_MST A
         WHERE 1=1
        <if test="categoryCd != null and categoryCd != ''">
           AND A.CATEGORY_CD = #{categoryCd}
        </if>
        <if test="learningCd != null and learningCd != ''">
           AND A.LEARNING_CD = #{learningCd}
        </if>
        <if test="teacherKey != null and teacherKey != ''">
           AND A.TEACHER_KEY = #{teacherKey}
        </if>
        <if test="isuse != null and isuse != ''">
           AND A.ISUSE = #{isuse}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
           AND A.SUBJECT_TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
         ORDER BY A.INDATE DESC, A.SEQ DESC
         LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <!-- 단과 강의 목록 카운트 -->
    <select id="selectLectureListCount" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="int">
        SELECT COUNT(*)
          FROM TB_OFF_LEC_MST A
         WHERE 1=1
        <if test="categoryCd != null and categoryCd != ''">
           AND A.CATEGORY_CD = #{categoryCd}
        </if>
        <if test="learningCd != null and learningCd != ''">
           AND A.LEARNING_CD = #{learningCd}
        </if>
        <if test="teacherKey != null and teacherKey != ''">
           AND A.TEACHER_KEY = #{teacherKey}
        </if>
        <if test="isuse != null and isuse != ''">
           AND A.ISUSE = #{isuse}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
           AND A.SUBJECT_TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
    </select>

    <!-- 단과 강의 상세 조회 -->
    <select id="selectLectureDetail" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.SEQ AS seq,
               A.LECCODE AS leccode,
               A.CATEGORY_CD AS categoryCd,
               A.LEARNING_CD AS learningCd,
               A.SUBJECT_TITLE AS subjectTitle,
               A.TEACHER_KEY AS teacherKey,
               A.LEL_DATE AS lelDate,
               A.LEC_GUBUN AS lecGubun,
               A.KIND AS kind,
               A.FORM AS form,
               A.LEC_NUM AS lecNum,
               A.PRICE AS price,
               A.SALE_PRICE AS salePrice,
               A.POINT_USER AS pointUser,
               A.LIMIT_DAY AS limitDay,
               A.MOBILE AS mobile,
               A.ORG_PRICE AS orgPrice,
               A.ISUSE AS isuse,
               A.INDATE AS indate,
               A.LEC_INFO AS lecInfo,
               A.LEC_CONTENT AS lecContent,
               A.LEC_TIME AS lecTime,
               A.PLACE AS place,
               (SELECT CATEGORY_NM FROM TB_CATEGORY WHERE CATEGORY_CD = A.CATEGORY_CD LIMIT 1) AS categoryNm,
               (SELECT LEARNING_NM FROM TB_LEARNING WHERE LEARNING_CD = A.LEARNING_CD LIMIT 1) AS learningNm,
               (SELECT TEACHER_NM FROM TB_TEACHER WHERE TEACHER_KEY = A.TEACHER_KEY LIMIT 1) AS teacherNm
          FROM TB_OFF_LEC_MST A
         WHERE A.LECCODE = #{leccode}
    </select>

    <!-- 단과 강의 등록 -->
    <insert id="insertLecture" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_LEC_MST (
            LECCODE, CATEGORY_CD, LEARNING_CD, SUBJECT_TITLE, TEACHER_KEY,
            LEL_DATE, LEC_GUBUN, KIND, FORM, LEC_NUM,
            PRICE, SALE_PRICE, POINT_USER, LIMIT_DAY, MOBILE,
            ORG_PRICE, ISUSE, INDATE, LEC_INFO, LEC_CONTENT,
            LEC_TIME, PLACE
        ) VALUES (
            #{leccode}, #{categoryCd}, #{learningCd}, #{subjectTitle}, #{teacherKey},
            #{lelDate}, #{lecGubun}, #{kind}, #{form}, #{lecNum},
            #{price}, #{salePrice}, #{pointUser}, #{limitDay}, #{mobile},
            #{orgPrice}, IFNULL(#{isuse}, 'Y'), NOW(), #{lecInfo}, #{lecContent},
            #{lecTime}, #{place}
        )
    </insert>

    <!-- 단과 강의 수정 -->
    <update id="updateLecture" parameterType="com.academy.lectureOff.service.LectureOffVO">
        UPDATE TB_OFF_LEC_MST
           SET CATEGORY_CD = #{categoryCd},
               LEARNING_CD = #{learningCd},
               SUBJECT_TITLE = #{subjectTitle},
               TEACHER_KEY = #{teacherKey},
               LEL_DATE = #{lelDate},
               LEC_GUBUN = #{lecGubun},
               KIND = #{kind},
               FORM = #{form},
               LEC_NUM = #{lecNum},
               PRICE = #{price},
               SALE_PRICE = #{salePrice},
               POINT_USER = #{pointUser},
               LIMIT_DAY = #{limitDay},
               MOBILE = #{mobile},
               ORG_PRICE = #{orgPrice},
               ISUSE = #{isuse},
               LEC_INFO = #{lecInfo},
               LEC_CONTENT = #{lecContent},
               LEC_TIME = #{lecTime},
               PLACE = #{place}
         WHERE LECCODE = #{leccode}
    </update>

    <!-- 단과 강의 삭제 -->
    <delete id="deleteLecture" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LEC_MST WHERE LECCODE = #{leccode}
    </delete>

    <!-- ============================================= -->
    <!-- 강의 브릿지 관리 -->
    <!-- ============================================= -->

    <!-- 강의 브릿지 목록 조회 -->
    <select id="selectLectureBridgeList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.BSEQ AS bseq,
               A.LECCODE AS leccode,
               A.BRIDGE_LECCODE AS bridgeLeccode,
               B.SUBJECT_TITLE AS subjectTitle,
               (SELECT TEACHER_NM FROM TB_TEACHER WHERE TEACHER_KEY = B.TEACHER_KEY LIMIT 1) AS teacherNm
          FROM TB_OFF_LEC_BRIDGE A
          LEFT JOIN TB_OFF_LEC_MST B ON A.BRIDGE_LECCODE = B.LECCODE
         WHERE A.LECCODE = #{leccode}
         ORDER BY A.BSEQ
    </select>

    <!-- 강의 브릿지 등록 -->
    <insert id="insertLectureBridge" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_LEC_BRIDGE (
            LECCODE, BRIDGE_LECCODE
        ) VALUES (
            #{leccode}, #{bridgeLeccode}
        )
    </insert>

    <!-- 강의 브릿지 삭제 -->
    <delete id="deleteLectureBridge" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LEC_BRIDGE WHERE BSEQ = #{bseq}
    </delete>

    <!-- 강의 브릿지 전체 삭제 (강의코드 기준) -->
    <delete id="deleteLectureBridgeByLeccode" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LEC_BRIDGE WHERE LECCODE = #{leccode}
    </delete>

    <!-- ============================================= -->
    <!-- 강의 교재 관리 -->
    <!-- ============================================= -->

    <!-- 강의 교재 목록 조회 -->
    <select id="selectLectureBookList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.IDX AS idx,
               A.LECCODE AS leccode,
               A.RSC_ID AS rscId,
               A.BOOK_NM AS bookNm,
               A.FLAG AS flag,
               B.RSC_NM AS rscNm,
               B.PRICE AS bookPrice
          FROM TB_OFF_PLUS_CA_BOOK A
          LEFT JOIN TB_BOOK B ON A.RSC_ID = B.RSC_ID
         WHERE A.LECCODE = #{leccode}
         ORDER BY A.IDX
    </select>

    <!-- 교재 검색 목록 조회 -->
    <select id="selectBookSearchList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT RSC_ID AS rscId,
               RSC_NM AS bookNm,
               PRICE AS bookPrice,
               ISUSE AS isuse
          FROM TB_BOOK
         WHERE ISUSE = 'Y'
        <if test="searchKeyword != null and searchKeyword != ''">
           AND RSC_NM LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
         ORDER BY RSC_NM
         LIMIT 100
    </select>

    <!-- 강의 교재 등록 -->
    <insert id="insertLectureBook" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_PLUS_CA_BOOK (
            LECCODE, RSC_ID, BOOK_NM, FLAG
        ) VALUES (
            #{leccode}, #{rscId}, #{bookNm}, IFNULL(#{flag}, 'N')
        )
    </insert>

    <!-- 강의 교재 삭제 -->
    <delete id="deleteLectureBook" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_PLUS_CA_BOOK WHERE IDX = #{idx}
    </delete>

    <!-- 강의 교재 전체 삭제 (강의코드 기준) -->
    <delete id="deleteLectureBookByLeccode" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_PLUS_CA_BOOK WHERE LECCODE = #{leccode}
    </delete>

    <!-- ============================================= -->
    <!-- 강의 일정 관리 -->
    <!-- ============================================= -->

    <!-- 강의 일정 목록 조회 -->
    <select id="selectLectureDateList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT NUM AS num,
               LECCODE AS leccode,
               DATE_FORMAT(LEC_DATE, '%Y-%m-%d') AS lecDate
          FROM TB_OFF_LECTURE_DATE
         WHERE LECCODE = #{leccode}
         ORDER BY NUM, LEC_DATE
    </select>

    <!-- 강의 일정 등록 -->
    <insert id="insertLectureDate" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_LECTURE_DATE (
            LECCODE, LEC_DATE
        ) VALUES (
            #{leccode}, #{lecDate}
        )
    </insert>

    <!-- 강의 일정 삭제 -->
    <delete id="deleteLectureDate" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LECTURE_DATE WHERE NUM = #{num}
    </delete>

    <!-- 강의 일정 전체 삭제 (강의코드 기준) -->
    <delete id="deleteLectureDateByLeccode" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LECTURE_DATE WHERE LECCODE = #{leccode}
    </delete>

    <!-- ============================================= -->
    <!-- 종합반 강의 관리 -->
    <!-- ============================================= -->

    <!-- 종합반 강의 목록 조회 -->
    <select id="selectJongLectureList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.JONGSEQ AS jongseq,
               A.MST_LECCODE AS mstLeccode,
               A.GUBUN AS gubun,
               A.JONG_NM AS jongNm,
               A.JONG_PRICE AS jongPrice,
               A.JONG_SALE_PRICE AS jongSalePrice,
               A.ISUSE AS isuse,
               DATE_FORMAT(A.INDATE, '%Y-%m-%d %H:%i:%s') AS indateStr,
               (SELECT COUNT(*) FROM TB_OFF_LEC_JONG WHERE JONGSEQ = A.JONGSEQ) AS lecCount
          FROM TB_OFF_LEC_JONG_MST A
         WHERE 1=1
        <if test="gubun != null and gubun != ''">
           AND A.GUBUN = #{gubun}
        </if>
        <if test="isuse != null and isuse != ''">
           AND A.ISUSE = #{isuse}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
           AND A.JONG_NM LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
         ORDER BY A.INDATE DESC, A.JONGSEQ DESC
         LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <!-- 종합반 강의 목록 카운트 -->
    <select id="selectJongLectureListCount" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="int">
        SELECT COUNT(*)
          FROM TB_OFF_LEC_JONG_MST A
         WHERE 1=1
        <if test="gubun != null and gubun != ''">
           AND A.GUBUN = #{gubun}
        </if>
        <if test="isuse != null and isuse != ''">
           AND A.ISUSE = #{isuse}
        </if>
        <if test="searchKeyword != null and searchKeyword != ''">
           AND A.JONG_NM LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
    </select>

    <!-- 종합반 강의 상세 조회 -->
    <select id="selectJongLectureDetail" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.JONGSEQ AS jongseq,
               A.MST_LECCODE AS mstLeccode,
               A.GUBUN AS gubun,
               A.JONG_NM AS jongNm,
               A.JONG_PRICE AS jongPrice,
               A.JONG_SALE_PRICE AS jongSalePrice,
               A.ISUSE AS isuse,
               A.INDATE AS indate,
               A.JONG_INFO AS jongInfo,
               A.JONG_CONTENT AS jongContent
          FROM TB_OFF_LEC_JONG_MST A
         WHERE A.JONGSEQ = #{jongseq}
    </select>

    <!-- 종합반 강의 등록 -->
    <insert id="insertJongLecture" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_LEC_JONG_MST (
            MST_LECCODE, GUBUN, JONG_NM, JONG_PRICE, JONG_SALE_PRICE,
            ISUSE, INDATE, JONG_INFO, JONG_CONTENT
        ) VALUES (
            #{mstLeccode}, #{gubun}, #{jongNm}, #{jongPrice}, #{jongSalePrice},
            IFNULL(#{isuse}, 'Y'), NOW(), #{jongInfo}, #{jongContent}
        )
        <selectKey keyProperty="jongseq" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 종합반 강의 수정 -->
    <update id="updateJongLecture" parameterType="com.academy.lectureOff.service.LectureOffVO">
        UPDATE TB_OFF_LEC_JONG_MST
           SET MST_LECCODE = #{mstLeccode},
               GUBUN = #{gubun},
               JONG_NM = #{jongNm},
               JONG_PRICE = #{jongPrice},
               JONG_SALE_PRICE = #{jongSalePrice},
               ISUSE = #{isuse},
               JONG_INFO = #{jongInfo},
               JONG_CONTENT = #{jongContent}
         WHERE JONGSEQ = #{jongseq}
    </update>

    <!-- 종합반 강의 삭제 -->
    <delete id="deleteJongLecture" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LEC_JONG_MST WHERE JONGSEQ = #{jongseq}
    </delete>

    <!-- ============================================= -->
    <!-- 종합반 강의 구성 관리 -->
    <!-- ============================================= -->

    <!-- 종합반 강의 구성 목록 조회 (단과 강의 목록) -->
    <select id="selectJongLectureDetailList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.JONGSEQ AS jongseq,
               A.MST_LECCODE AS mstLeccode,
               A.SORT AS sort,
               B.SUBJECT_TITLE AS subjectTitle,
               B.PRICE AS price,
               B.SALE_PRICE AS salePrice,
               (SELECT TEACHER_NM FROM TB_TEACHER WHERE TEACHER_KEY = B.TEACHER_KEY LIMIT 1) AS teacherNm,
               (SELECT CATEGORY_NM FROM TB_CATEGORY WHERE CATEGORY_CD = B.CATEGORY_CD LIMIT 1) AS categoryNm
          FROM TB_OFF_LEC_JONG A
          LEFT JOIN TB_OFF_LEC_MST B ON A.MST_LECCODE = B.LECCODE
         WHERE A.JONGSEQ = #{jongseq}
         ORDER BY A.SORT
    </select>

    <!-- 종합반 강의 구성 등록 -->
    <insert id="insertJongLectureDetail" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_LEC_JONG (
            JONGSEQ, MST_LECCODE, SORT
        ) VALUES (
            #{jongseq}, #{mstLeccode}, #{sort}
        )
    </insert>

    <!-- 종합반 강의 구성 삭제 -->
    <delete id="deleteJongLectureDetail" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LEC_JONG
         WHERE JONGSEQ = #{jongseq}
           AND MST_LECCODE = #{mstLeccode}
    </delete>

    <!-- 종합반 강의 구성 전체 삭제 (종합반 SEQ 기준) -->
    <delete id="deleteJongLectureDetailByJongseq" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_LEC_JONG WHERE JONGSEQ = #{jongseq}
    </delete>

    <!-- ============================================= -->
    <!-- 선택형 종합반 관리 -->
    <!-- ============================================= -->

    <!-- 선택형 종합반 목록 조회 -->
    <select id="selectChoiceJongList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT A.JONGSEQ AS jongseq,
               A.JONG_NO AS jongNo,
               A.LECCODE AS leccode,
               B.SUBJECT_TITLE AS subjectTitle,
               (SELECT TEACHER_NM FROM TB_TEACHER WHERE TEACHER_KEY = B.TEACHER_KEY LIMIT 1) AS teacherNm
          FROM TB_OFF_CHOICE_JONG_NO A
          LEFT JOIN TB_OFF_LEC_MST B ON A.LECCODE = B.LECCODE
         WHERE A.JONGSEQ = #{jongseq}
         ORDER BY A.JONG_NO, A.LECCODE
    </select>

    <!-- 선택형 종합반 등록 -->
    <insert id="insertChoiceJong" parameterType="com.academy.lectureOff.service.LectureOffVO">
        INSERT INTO TB_OFF_CHOICE_JONG_NO (
            JONGSEQ, JONG_NO, LECCODE
        ) VALUES (
            #{jongseq}, #{jongNo}, #{leccode}
        )
    </insert>

    <!-- 선택형 종합반 삭제 -->
    <delete id="deleteChoiceJong" parameterType="com.academy.lectureOff.service.LectureOffVO">
        DELETE FROM TB_OFF_CHOICE_JONG_NO
         WHERE JONGSEQ = #{jongseq}
        <if test="jongNo != null and jongNo != ''">
           AND JONG_NO = #{jongNo}
        </if>
        <if test="leccode != null and leccode != ''">
           AND LECCODE = #{leccode}
        </if>
    </delete>

    <!-- ============================================= -->
    <!-- 카테고리/과목/강사 조회 -->
    <!-- ============================================= -->

    <!-- 카테고리 목록 조회 -->
    <select id="selectCategoryList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT CATEGORY_CD AS categoryCd,
               CATEGORY_NM AS categoryNm
          FROM TB_CATEGORY
         WHERE ISUSE = 'Y'
         ORDER BY SORT_NO, CATEGORY_NM
    </select>

    <!-- 과목 목록 조회 -->
    <select id="selectSubjectList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT LEARNING_CD AS learningCd,
               LEARNING_NM AS learningNm
          FROM TB_LEARNING
         WHERE ISUSE = 'Y'
        <if test="categoryCd != null and categoryCd != ''">
           AND CATEGORY_CD = #{categoryCd}
        </if>
         ORDER BY SORT_NO, LEARNING_NM
    </select>

    <!-- 강사 목록 조회 -->
    <select id="selectTeacherList" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="com.academy.lectureOff.service.LectureOffVO">
        SELECT TEACHER_KEY AS teacherKey,
               TEACHER_NM AS teacherNm
          FROM TB_TEACHER
         WHERE ISUSE = 'Y'
        <if test="learningCd != null and learningCd != ''">
           AND LEARNING_CD = #{learningCd}
        </if>
         ORDER BY TEACHER_NM
    </select>

    <!-- ============================================= -->
    <!-- 강의코드 생성 -->
    <!-- ============================================= -->

    <!-- 다음 강의코드 조회 -->
    <select id="selectNextLeccode" parameterType="com.academy.lectureOff.service.LectureOffVO" resultType="string">
        SELECT CONCAT('OFF', DATE_FORMAT(NOW(), '%Y%m%d'),
                      LPAD(IFNULL(MAX(CAST(SUBSTRING(LECCODE, 12) AS UNSIGNED)), 0) + 1, 4, '0'))
          FROM TB_OFF_LEC_MST
         WHERE LECCODE LIKE CONCAT('OFF', DATE_FORMAT(NOW(), '%Y%m%d'), '%')
    </select>

    <!-- 다음 종합반 SEQ 조회 -->
    <select id="selectNextJongseq" resultType="int">
        SELECT IFNULL(MAX(JONGSEQ), 0) + 1 FROM TB_OFF_LEC_JONG_MST
    </select>

</mapper>
